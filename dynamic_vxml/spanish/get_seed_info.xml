<?xml version="1.0" encoding="UTF-8"?>
<vxml version="2.1">
    <form id="seedSelectionForm">
        <block>
            <data name="seedTypes" src="https://seedlinkvu.000webhostapp.com/backend/get_seed_types/index.php" />
            <submit next="" method="post" namelist="seedType" />
        </block>

        <field name="seedType">
            <prompt>Elige un tipo de semilla:</prompt>
            <foreach item="seedType" array="seedTypes">
                <prompt>
                    Prensa <value expr="index + 1" dtmf="key" /> o decir <value expr="seedType" /> para <value expr="seedType" />.
                </prompt>
            </foreach>
            <grammar xml:lang="es-mx" type="application/grammar+voicexml">
                <rule id="seedTypeRule" scope="public">
                    <one-of>
                        <item repeat="0-inf" weight="1">
                            <tag>out.seedType = $value;</tag>
                            <item>
                                <ruleref uri="#seedTypes"/>
                            </item>
                        </item>
                    </one-of>
                </rule>
                <rule id="seedTypes">
                    <one-of>
                        <?php
                                $seedTypes = json_decode($data['seedTypes']);
                                foreach ($seedTypes as $seedType) {
                                echo '<item>' . $seedType . '</item>';
                                }
                                ?>
                    </one-of>
                </rule>
            </grammar>
            <filled>
                <if cond="seedType">
                    <block>
                        <if cond="event.inputmode == 'dtmf'">
                            <prompt>Usted seleccionó el tipo de semilla <value expr="seedType" /> utilizando el modo de entrada DTMF.</prompt>
                        </if>
                        <elseif cond="event.inputmode == 'voice'" >
                            <prompt>Usted seleccionó el tipo de semilla <value expr="seedType" /> utilizando el modo de entrada de voz.</prompt>
                        </elseif>
                        <else>
                            <prompt>Selección invalida. Inténtalo de nuevo.</prompt>
                        </else>
                        <data name="seedTypeDescriptions" src="https://seedlinkvu.000webhostapp.com/backend/get_descriptions_by_seed_type_spanish/index.php?seed_type={seedType}" />
                        <goto next="#seedDescriptions" />
                    </block>
                </if>
                <else>
                    <reprompt />
                </else>
            </filled>
        </field>

        <block id="seedDescriptions">
            <foreach item="description" array="seedTypeDescriptions">
                <prompt>
                    <value expr="description" />
                </prompt>
            </foreach>
            <prompt>Eso es todo, gracias por usar nuestra aplicación. ¡Que tengas un buen día y adiós!</prompt>
            <exit />
        </block>
    </form>
</vxml>